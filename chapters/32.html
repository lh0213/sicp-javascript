<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SicpTextbookRails</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="AM9RYUP6gXpZu155JXimz0Jy/Mb/j9wjqwT6rQ5ZJXqUTiPrLvjnA71OU7YabEVzGsQjiqOYXZv7xGy86mNeBw==" />

    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    -->
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans|Droid+Sans+Mono|Droid+Serif" rel="stylesheet">
    <link rel="stylesheet" media="all" href="../assets/application-4afa0dc75ea8a2ff925eb41df709aa5f5fae6640df639d9b6ae50ed06be5a5d2.css" />

    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon-5cc7f923fb946d60fe9552847f4b6edd0f8cf2f122d6f3fef39d59ce84d47942.ico" />

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
			  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	          crossorigin="anonymous">
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>

    <script src="../assets/application-e1d34c17f2d1680f21b650089aea08e3ecfe292f1157f2d23bfa7d4d9d530c8b.js"></script>

    <!-- Rendering inline LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          jax: ["input/TeX","output/HTML-CSS"]
        }
      });
    </script>
    <!--<script src="/mathjax/MathJax.js?config=TeX-AMS_HTML-full.js" type="text/javascript"></script>-->
    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>

     <nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse fixed-top">
      <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#nav-sidebar" aria-controls="nav-sidebar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
       <a class="navbar-brand navbar-brand-short" href="../chapters.html">CS1101S: SICP</a>
       <a class="navbar-brand navbar-brand-long" href="../chapters.html">CS1101S: Structure and Interpretation
          of Computer Programs</a>

       <div class="collapse navbar-collapse" id="navbarsExampleDefault">
         <form id="search" class="form-inline my-2 my-lg-0">
           <input id="search-box" class="form-control mr-sm-2" type="text" placeholder="Search">
           <div id="search-button" class="btn btn-outline-success my-2 my-sm-0">Search</div>

           <script>
               (function() {
                var cx = "002429487986305006822:ztnrbwx01qy";
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
               })();
            </script>
            <gcse:search></gcse:search>
         </form>
       </div>
     </nav>

     <div class="container scroll">

          <div class="collapse" id="nav-sidebar" role="tablist" aria-multiselectable="true">
                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-122">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-122" aria-expanded="false" aria-controls="sidebar-collapse-122">
                    <a href="122.html">About</a>
                  </a>
                </h5>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-123">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-123" aria-expanded="false" aria-controls="sidebar-collapse-123">
                    <a href="123.html">References</a>
                  </a>
                </h5>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-124">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-124" aria-expanded="false" aria-controls="sidebar-collapse-124">
                    <a href="124.html">Webpreface</a>
                  </a>
                </h5>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-1">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-1" aria-expanded="true" aria-controls="sidebar-collapse-1">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-1" aria-expanded="true" aria-controls="sidebar-collapse-1">
                    -
                  </a>
                    <a href="1.html">1.       Building Abstractions with       Functions    </a>
                </h5>
              </div>
              <div id="sidebar-collapse-1" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-2">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-2" aria-expanded="true" aria-controls="sidebar-collapse-2">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-2" aria-expanded="true" aria-controls="sidebar-collapse-2">
                    -
                  </a>
                    <a href="2.html">1. The Elements of Programming</a>
                </h5>
              </div>
              <div id="sidebar-collapse-2" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-3">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-3" aria-expanded="false" aria-controls="sidebar-collapse-3">
                    <a href="3.html">1. Expressions</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-4">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-4" aria-expanded="false" aria-controls="sidebar-collapse-4">
                    <a href="4.html">2. Naming and the Environment</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-5">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-5" aria-expanded="false" aria-controls="sidebar-collapse-5">
                    <a href="5.html">3.           Evaluating          Operator Combinations                  </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-6">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-6" aria-expanded="false" aria-controls="sidebar-collapse-6">
                    <a href="6.html">4.           Functions        </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-7">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-7" aria-expanded="false" aria-controls="sidebar-collapse-7">
                    <a href="7.html">5.           The Substitution Model for                                                 Function                              Application        </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-8">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-8" aria-expanded="false" aria-controls="sidebar-collapse-8">
                    <a href="8.html">6.           Conditional                                           Statements                              and Predicates        </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-9">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-9" aria-expanded="false" aria-controls="sidebar-collapse-9">
                    <a href="9.html">7. Example: Square Roots by Newtons Method</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-10">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-2" href="#sidebar-collapse-10" aria-expanded="false" aria-controls="sidebar-collapse-10">
                    <a href="10.html">8.                                                 Functions                                as Black-Box Abstractions        </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-11">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-11" aria-expanded="true" aria-controls="sidebar-collapse-11">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-11" aria-expanded="true" aria-controls="sidebar-collapse-11">
                    -
                  </a>
                    <a href="11.html">2.             Functions            and the Processes They Generate      </a>
                </h5>
              </div>
              <div id="sidebar-collapse-11" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-12">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-12" aria-expanded="false" aria-controls="sidebar-collapse-12">
                    <a href="12.html">1. Linear Recursion and Iteration</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-13">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-13" aria-expanded="false" aria-controls="sidebar-collapse-13">
                    <a href="13.html">2. Tree Recursion</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-14">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-14" aria-expanded="false" aria-controls="sidebar-collapse-14">
                    <a href="14.html">3. Orders of Growth</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-15">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-15" aria-expanded="false" aria-controls="sidebar-collapse-15">
                    <a href="15.html">4. Exponentiation</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-16">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-16" aria-expanded="false" aria-controls="sidebar-collapse-16">
                    <a href="16.html">5. Greatest Common Divisors</a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-17">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-11" href="#sidebar-collapse-17" aria-expanded="false" aria-controls="sidebar-collapse-17">
                    <a href="17.html">6. Example: Testing for Primality</a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-18">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-18" aria-expanded="true" aria-controls="sidebar-collapse-18">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-1" href="#sidebar-collapse-18" aria-expanded="true" aria-controls="sidebar-collapse-18">
                    -
                  </a>
                    <a href="18.html">3.         Formulating Abstractions with Higher-Order         Functions      </a>
                </h5>
              </div>
              <div id="sidebar-collapse-18" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-19">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-18" href="#sidebar-collapse-19" aria-expanded="false" aria-controls="sidebar-collapse-19">
                    <a href="19.html">1.           Functions          as Arguments        </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-20">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-18" href="#sidebar-collapse-20" aria-expanded="false" aria-controls="sidebar-collapse-20">
                    <a href="20.html">2.           Function Definition Expressions          </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-21">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-18" href="#sidebar-collapse-21" aria-expanded="false" aria-controls="sidebar-collapse-21">
                    <a href="21.html">3.             Functions            as General Methods          </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-22">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-18" href="#sidebar-collapse-22" aria-expanded="false" aria-controls="sidebar-collapse-22">
                    <a href="22.html">4.               Functions              as Returned Values            </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-23">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-23" aria-expanded="true" aria-controls="sidebar-collapse-23">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-23" aria-expanded="true" aria-controls="sidebar-collapse-23">
                    -
                  </a>
                    <a href="23.html">2. Building Abstractions with Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-23" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-24">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-24" aria-expanded="true" aria-controls="sidebar-collapse-24">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-24" aria-expanded="true" aria-controls="sidebar-collapse-24">
                    -
                  </a>
                    <a href="24.html">1. Introduction to Data Abstraction</a>
                </h5>
              </div>
              <div id="sidebar-collapse-24" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-25">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-24" href="#sidebar-collapse-25" aria-expanded="false" aria-controls="sidebar-collapse-25">
                    <a href="25.html">1.         Example: Arithmetic Operations for Rational Numbers      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-26">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-24" href="#sidebar-collapse-26" aria-expanded="false" aria-controls="sidebar-collapse-26">
                    <a href="26.html">2.         Abstraction Barriers      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-27">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-24" href="#sidebar-collapse-27" aria-expanded="false" aria-controls="sidebar-collapse-27">
                    <a href="27.html">3.         What Is Meant by Data?      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-28">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-24" href="#sidebar-collapse-28" aria-expanded="false" aria-controls="sidebar-collapse-28">
                    <a href="28.html">4.         Extended Exercise: Interval Arithmetic      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-29">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-29" aria-expanded="true" aria-controls="sidebar-collapse-29">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-29" aria-expanded="true" aria-controls="sidebar-collapse-29">
                    -
                  </a>
                    <a href="29.html">2. Hierarchical Data and the Closure Property</a>
                </h5>
              </div>
              <div id="sidebar-collapse-29" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-30">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-29" href="#sidebar-collapse-30" aria-expanded="false" aria-controls="sidebar-collapse-30">
                    <a href="30.html">1.         Representing Sequences      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-31">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-29" href="#sidebar-collapse-31" aria-expanded="false" aria-controls="sidebar-collapse-31">
                    <a href="31.html">2.         Hierarchical Structures      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-32">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-29" href="#sidebar-collapse-32" aria-expanded="false" aria-controls="sidebar-collapse-32">
                    <a href="32.html">3.         Sequences as Conventional Interfaces      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-33">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-29" href="#sidebar-collapse-33" aria-expanded="false" aria-controls="sidebar-collapse-33">
                    <a href="33.html">4.         Example: A Picture Language      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-34">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-34" aria-expanded="true" aria-controls="sidebar-collapse-34">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-34" aria-expanded="true" aria-controls="sidebar-collapse-34">
                    -
                  </a>
                    <a href="34.html">3. Symbolic Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-34" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-35">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-34" href="#sidebar-collapse-35" aria-expanded="false" aria-controls="sidebar-collapse-35">
                    <a href="35.html">1.         Strings      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-36">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-34" href="#sidebar-collapse-36" aria-expanded="false" aria-controls="sidebar-collapse-36">
                    <a href="36.html">2.         Example: Symbolic Differentiation      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-37">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-34" href="#sidebar-collapse-37" aria-expanded="false" aria-controls="sidebar-collapse-37">
                    <a href="37.html">3.         Example: Representing Sets      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-38">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-34" href="#sidebar-collapse-38" aria-expanded="false" aria-controls="sidebar-collapse-38">
                    <a href="38.html">4.         Example: Huffman Encoding Trees      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-39">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-39" aria-expanded="true" aria-controls="sidebar-collapse-39">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-39" aria-expanded="true" aria-controls="sidebar-collapse-39">
                    -
                  </a>
                    <a href="39.html">4. Multiple Representations for Abstract Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-39" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-40">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-39" href="#sidebar-collapse-40" aria-expanded="false" aria-controls="sidebar-collapse-40">
                    <a href="40.html">1.         Representations for Complex Numbers      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-41">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-39" href="#sidebar-collapse-41" aria-expanded="false" aria-controls="sidebar-collapse-41">
                    <a href="41.html">2.         Tagged data      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-42">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-39" href="#sidebar-collapse-42" aria-expanded="false" aria-controls="sidebar-collapse-42">
                    <a href="42.html">3.         Data-Directed Programming and Additivity      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-43">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-23" href="#sidebar-collapse-43" aria-expanded="true" aria-controls="sidebar-collapse-43">
                    -
                  </a>
                    <a href="43.html">5. Systems with Generic Operations</a>
                </h5>
              </div>
              <div id="sidebar-collapse-43" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-44">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-43" href="#sidebar-collapse-44" aria-expanded="false" aria-controls="sidebar-collapse-44">
                    <a href="44.html">1.         Generic Arithmetic Operations      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-45">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-43" href="#sidebar-collapse-45" aria-expanded="false" aria-controls="sidebar-collapse-45">
                    <a href="45.html">2.         Combining Data of Different Types      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-46">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-43" href="#sidebar-collapse-46" aria-expanded="false" aria-controls="sidebar-collapse-46">
                    <a href="46.html">3.         Example: Symbolic Algebra      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-47">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-47" aria-expanded="true" aria-controls="sidebar-collapse-47">
                    -
                  </a>
                    <a href="47.html">3. Modularity, Objects, and State</a>
                </h5>
              </div>
              <div id="sidebar-collapse-47" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-48">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-48" aria-expanded="true" aria-controls="sidebar-collapse-48">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-48" aria-expanded="true" aria-controls="sidebar-collapse-48">
                    -
                  </a>
                    <a href="48.html">1. Assignment and Local State</a>
                </h5>
              </div>
              <div id="sidebar-collapse-48" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-49">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-48" href="#sidebar-collapse-49" aria-expanded="false" aria-controls="sidebar-collapse-49">
                    <a href="49.html">1.         Local State Variables      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-50">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-48" href="#sidebar-collapse-50" aria-expanded="false" aria-controls="sidebar-collapse-50">
                    <a href="50.html">2.         The Benefits of Introducing Assignment      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-51">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-48" href="#sidebar-collapse-51" aria-expanded="false" aria-controls="sidebar-collapse-51">
                    <a href="51.html">3.         The Costs of Introducing Assignment      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-52">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-52" aria-expanded="true" aria-controls="sidebar-collapse-52">
                    -
                  </a>
                    <a href="52.html">2. The Environment Model of Evaluation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-52" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-53">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-52" href="#sidebar-collapse-53" aria-expanded="false" aria-controls="sidebar-collapse-53">
                    <a href="53.html">1.         The Rules for Evaluation      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-54">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-52" href="#sidebar-collapse-54" aria-expanded="false" aria-controls="sidebar-collapse-54">
                    <a href="54.html">2.         Applying Simple        Functions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-55">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-52" href="#sidebar-collapse-55" aria-expanded="false" aria-controls="sidebar-collapse-55">
                    <a href="55.html">3.         Frames as the Repository of Local State      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-56">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-52" href="#sidebar-collapse-56" aria-expanded="false" aria-controls="sidebar-collapse-56">
                    <a href="56.html">4.         Internal Definitions      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-57">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-57" aria-expanded="true" aria-controls="sidebar-collapse-57">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-57" aria-expanded="true" aria-controls="sidebar-collapse-57">
                    -
                  </a>
                    <a href="57.html">3. Modeling with Mutable Data</a>
                </h5>
              </div>
              <div id="sidebar-collapse-57" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-58">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-57" href="#sidebar-collapse-58" aria-expanded="false" aria-controls="sidebar-collapse-58">
                    <a href="58.html">1.         Mutable List Structure      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-59">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-57" href="#sidebar-collapse-59" aria-expanded="false" aria-controls="sidebar-collapse-59">
                    <a href="59.html">2.         Representing Queues      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-60">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-57" href="#sidebar-collapse-60" aria-expanded="false" aria-controls="sidebar-collapse-60">
                    <a href="60.html">3.         Representing Tables      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-61">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-57" href="#sidebar-collapse-61" aria-expanded="false" aria-controls="sidebar-collapse-61">
                    <a href="61.html">4.         A Simulator for Digital Circuits      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-62">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-57" href="#sidebar-collapse-62" aria-expanded="false" aria-controls="sidebar-collapse-62">
                    <a href="62.html">5.         Propagation of Constraints      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-63">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-63" aria-expanded="true" aria-controls="sidebar-collapse-63">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-63" aria-expanded="true" aria-controls="sidebar-collapse-63">
                    -
                  </a>
                    <a href="63.html">4. Concurrency: Time Is of the Essence</a>
                </h5>
              </div>
              <div id="sidebar-collapse-63" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-64">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-63" href="#sidebar-collapse-64" aria-expanded="false" aria-controls="sidebar-collapse-64">
                    <a href="64.html">1.         The Nature of Time in Concurrent Systems      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-65">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-63" href="#sidebar-collapse-65" aria-expanded="false" aria-controls="sidebar-collapse-65">
                    <a href="65.html">2.         Mechanisms for Controlling Concurrency      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-66">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-66" aria-expanded="true" aria-controls="sidebar-collapse-66">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-47" href="#sidebar-collapse-66" aria-expanded="true" aria-controls="sidebar-collapse-66">
                    -
                  </a>
                    <a href="66.html">5. Streams</a>
                </h5>
              </div>
              <div id="sidebar-collapse-66" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-67">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-66" href="#sidebar-collapse-67" aria-expanded="false" aria-controls="sidebar-collapse-67">
                    <a href="67.html">1.         Streams Are Delayed Lists      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-68">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-66" href="#sidebar-collapse-68" aria-expanded="false" aria-controls="sidebar-collapse-68">
                    <a href="68.html">2.         Infinite Streams      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-69">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-66" href="#sidebar-collapse-69" aria-expanded="false" aria-controls="sidebar-collapse-69">
                    <a href="69.html">3.   Exploiting the Stream Paradigm      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-70">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-66" href="#sidebar-collapse-70" aria-expanded="false" aria-controls="sidebar-collapse-70">
                    <a href="70.html">4.   Streams and Delayed Evaluation      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-71">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-66" href="#sidebar-collapse-71" aria-expanded="false" aria-controls="sidebar-collapse-71">
                    <a href="71.html">5.   Modularity of Functional Programs and Modularity of Objects      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-72">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-72" aria-expanded="true" aria-controls="sidebar-collapse-72">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-72" aria-expanded="true" aria-controls="sidebar-collapse-72">
                    -
                  </a>
                    <a href="72.html">4. Metalinguistic Abstraction</a>
                </h5>
              </div>
              <div id="sidebar-collapse-72" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-73">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-73" aria-expanded="true" aria-controls="sidebar-collapse-73">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-73" aria-expanded="true" aria-controls="sidebar-collapse-73">
                    -
                  </a>
                    <a href="73.html">1. The Metacircular Evaluator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-73" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-74">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-74" aria-expanded="false" aria-controls="sidebar-collapse-74">
                    <a href="74.html">1.   The Core of the Evaluator      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-75">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-75" aria-expanded="false" aria-controls="sidebar-collapse-75">
                    <a href="75.html">2.   Representing Statements and Expressions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-76">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-76" aria-expanded="false" aria-controls="sidebar-collapse-76">
                    <a href="76.html">3.   Evaluator Data Structures      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-77">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-77" aria-expanded="false" aria-controls="sidebar-collapse-77">
                    <a href="77.html">4.   Running the Evaluator as a Program      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-78">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-78" aria-expanded="false" aria-controls="sidebar-collapse-78">
                    <a href="78.html">5.   Data as Programs      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-79">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-79" aria-expanded="false" aria-controls="sidebar-collapse-79">
                    <a href="79.html">6.   Internal Definitions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-80">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-73" href="#sidebar-collapse-80" aria-expanded="false" aria-controls="sidebar-collapse-80">
                    <a href="80.html">7.   Separating Syntactic Analysis from Execution      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-81">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-81" aria-expanded="true" aria-controls="sidebar-collapse-81">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-81" aria-expanded="true" aria-controls="sidebar-collapse-81">
                    -
                  </a>
                    <a href="81.html">2. Variations on a SchemeLazy Evaluation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-81" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-82">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-81" href="#sidebar-collapse-82" aria-expanded="false" aria-controls="sidebar-collapse-82">
                    <a href="82.html">1.   Normal Order and Applicative Order      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-83">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-81" href="#sidebar-collapse-83" aria-expanded="false" aria-controls="sidebar-collapse-83">
                    <a href="83.html">2.   An Interpreter with Lazy Evaluation      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-84">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-81" href="#sidebar-collapse-84" aria-expanded="false" aria-controls="sidebar-collapse-84">
                    <a href="84.html">3.   Streams as Lazy Lists      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-85">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-85" aria-expanded="true" aria-controls="sidebar-collapse-85">
                    -
                  </a>
                    <a href="85.html">3. Variations on a SchemeNondeterministic Computing</a>
                </h5>
              </div>
              <div id="sidebar-collapse-85" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-86">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-85" href="#sidebar-collapse-86" aria-expanded="false" aria-controls="sidebar-collapse-86">
                    <a href="86.html">1.   Amb and Search      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-87">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-85" href="#sidebar-collapse-87" aria-expanded="false" aria-controls="sidebar-collapse-87">
                    <a href="87.html">2.   Examples of Nondeterministic Programs      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-88">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-85" href="#sidebar-collapse-88" aria-expanded="false" aria-controls="sidebar-collapse-88">
                    <a href="88.html">3.   Implementing the Amb Evaluator      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-89">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-72" href="#sidebar-collapse-89" aria-expanded="true" aria-controls="sidebar-collapse-89">
                    -
                  </a>
                    <a href="89.html">4. Logic Programming</a>
                </h5>
              </div>
              <div id="sidebar-collapse-89" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-90">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-89" href="#sidebar-collapse-90" aria-expanded="false" aria-controls="sidebar-collapse-90">
                    <a href="90.html">1.   Deductive Information Retrieval      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-91">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-89" href="#sidebar-collapse-91" aria-expanded="false" aria-controls="sidebar-collapse-91">
                    <a href="91.html">2.   How the Query System Works      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-92">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-89" href="#sidebar-collapse-92" aria-expanded="false" aria-controls="sidebar-collapse-92">
                    <a href="92.html">3.   Is Logic Programming Mathematical Logic?      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-93">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-89" href="#sidebar-collapse-93" aria-expanded="false" aria-controls="sidebar-collapse-93">
                    <a href="93.html">4.   Implementing the Query System      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

                             <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-94">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-94" aria-expanded="true" aria-controls="sidebar-collapse-94">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#nav-sidebar" href="#sidebar-collapse-94" aria-expanded="true" aria-controls="sidebar-collapse-94">
                    -
                  </a>
                    <a href="94.html">5. Computing with Register Machines</a>
                </h5>
              </div>
              <div id="sidebar-collapse-94" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-95">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-95" aria-expanded="true" aria-controls="sidebar-collapse-95">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-95" aria-expanded="true" aria-controls="sidebar-collapse-95">
                    -
                  </a>
                    <a href="95.html">1. Designing Register Machines</a>
                </h5>
              </div>
              <div id="sidebar-collapse-95" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-96">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-95" href="#sidebar-collapse-96" aria-expanded="false" aria-controls="sidebar-collapse-96">
                    <a href="96.html">1.   A Language for Describing Register Machines      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-97">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-95" href="#sidebar-collapse-97" aria-expanded="false" aria-controls="sidebar-collapse-97">
                    <a href="97.html">2.   Abstraction in Machine Design      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-98">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-95" href="#sidebar-collapse-98" aria-expanded="false" aria-controls="sidebar-collapse-98">
                    <a href="98.html">3.   Subroutines      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-99">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-95" href="#sidebar-collapse-99" aria-expanded="false" aria-controls="sidebar-collapse-99">
                    <a href="99.html">4.   Using a Stack to Implement Recursion      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-100">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-95" href="#sidebar-collapse-100" aria-expanded="false" aria-controls="sidebar-collapse-100">
                    <a href="100.html">5.   Instruction Summary      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-101">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-101" aria-expanded="true" aria-controls="sidebar-collapse-101">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-101" aria-expanded="true" aria-controls="sidebar-collapse-101">
                    -
                  </a>
                    <a href="101.html">2. A Register-Machine Simulator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-101" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-102">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-101" href="#sidebar-collapse-102" aria-expanded="false" aria-controls="sidebar-collapse-102">
                    <a href="102.html">1.   The Machine Model      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-103">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-101" href="#sidebar-collapse-103" aria-expanded="false" aria-controls="sidebar-collapse-103">
                    <a href="103.html">2.   The Assembler      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-104">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-101" href="#sidebar-collapse-104" aria-expanded="false" aria-controls="sidebar-collapse-104">
                    <a href="104.html">3.   Generating Execution  Functions  for Instructions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-105">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-101" href="#sidebar-collapse-105" aria-expanded="false" aria-controls="sidebar-collapse-105">
                    <a href="105.html">4.   Monitoring Machine Performance      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-106">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-106" aria-expanded="true" aria-controls="sidebar-collapse-106">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-106" aria-expanded="true" aria-controls="sidebar-collapse-106">
                    -
                  </a>
                    <a href="106.html">3. Storage Allocation and Garbage Collection</a>
                </h5>
              </div>
              <div id="sidebar-collapse-106" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-107">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-106" href="#sidebar-collapse-107" aria-expanded="false" aria-controls="sidebar-collapse-107">
                    <a href="107.html">1.   Memory as Vectors      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-108">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-106" href="#sidebar-collapse-108" aria-expanded="false" aria-controls="sidebar-collapse-108">
                    <a href="108.html">2.   Maintaining the Illusion of Infinite Memory      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-109">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-109" aria-expanded="true" aria-controls="sidebar-collapse-109">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-109" aria-expanded="true" aria-controls="sidebar-collapse-109">
                    -
                  </a>
                    <a href="109.html">4. The Explicit-Control Evaluator</a>
                </h5>
              </div>
              <div id="sidebar-collapse-109" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-110">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-109" href="#sidebar-collapse-110" aria-expanded="false" aria-controls="sidebar-collapse-110">
                    <a href="110.html">1.   The Core of the Explicit-Control Evaluator      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-111">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-109" href="#sidebar-collapse-111" aria-expanded="false" aria-controls="sidebar-collapse-111">
                    <a href="111.html">2.   Sequence Evaluation and Tail Recursion      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-112">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-109" href="#sidebar-collapse-112" aria-expanded="false" aria-controls="sidebar-collapse-112">
                    <a href="112.html">3.   Conditionals, Assignments, and Definitions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-113">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-109" href="#sidebar-collapse-113" aria-expanded="false" aria-controls="sidebar-collapse-113">
                    <a href="113.html">4.   Running the Evaluator      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-114">
                <h5 class="mb-0">
                  <a class="sidebar-show collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-114" aria-expanded="true" aria-controls="sidebar-collapse-114">
                    +
                  </a>
                  <a class="sidebar-hide collapsed" data-toggle="collapse" data-parent="#sidebar-94" href="#sidebar-collapse-114" aria-expanded="true" aria-controls="sidebar-collapse-114">
                    -
                  </a>
                    <a href="114.html">5. Compilation</a>
                </h5>
              </div>
              <div id="sidebar-collapse-114" class="collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="card-block">
                                <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-115">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-115" aria-expanded="false" aria-controls="sidebar-collapse-115">
                    <a href="115.html">1.   Structure of the Compiler      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-116">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-116" aria-expanded="false" aria-controls="sidebar-collapse-116">
                    <a href="116.html">2.   Compiling Expressions      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-117">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-117" aria-expanded="false" aria-controls="sidebar-collapse-117">
                    <a href="117.html">3.   Compiling Combinations      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-118">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-118" aria-expanded="false" aria-controls="sidebar-collapse-118">
                    <a href="118.html">4.   Combining Instruction Sequences      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-119">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-119" aria-expanded="false" aria-controls="sidebar-collapse-119">
                    <a href="119.html">5.   An Example of Compiled Code      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-120">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-120" aria-expanded="false" aria-controls="sidebar-collapse-120">
                    <a href="120.html">6.   Lexical Addressing      </a>
                  </a>
                </h5>
              </div>
            </div>
            <div class="card card-inverse">
              <div class="card-header" role="tab" id="sidebar-121">
                <h5 class="mb-0">
                  <a class="collapsed" data-toggle="collapse" data-parent="#sidebar-114" href="#sidebar-collapse-121" aria-expanded="false" aria-controls="sidebar-collapse-121">
                    <a href="121.html">7.   Interfacing Compiled Code to the Evaluator      </a>
                  </a>
                </h5>
              </div>
            </div>

                </div>
              </div>
            </div>

                </div>
              </div>
            </div>

          </div>

           <div class="chapter-content">
    <div class="chapter-title">
        2.2.3.
        Sequences as Conventional Interfaces
      
    </div>
    <div class="chapter-text" >
        <div class="SUBSECTION"><SUBSECTION>
      

      
      
      

      <p>
        In working with compound data, we've stressed how data abstraction
        permits us to design programs without becoming enmeshed in the details
        of data representations, and how abstraction preserves for us the
        flexibility to experiment with alternative representations.  In this
        section, we introduce another powerful design principle for working
        with data structures—the use of <EM>conventional interfaces</EM>.
      </p>

      <p>
        In Section <REF NAME="sec:higher-order-procedures"></REF> we saw how program
        abstractions, implemented as higher-order
        functions, can capture
        common patterns in programs that deal with numerical data.  Our
        ability to formulate analogous operations for working with compound
        data depends crucially on the style in which we manipulate our data
        structures.  Consider, for example, the following
        function, analogous
        to the <kbd>count_leaves</kbd>
        function
        of Section <REF NAME="sec:trees"></REF>, which
        takes a tree as argument and computes the sum of the squares of the
        leaves that are odd:

        

        <div class="snippet" id="javascript_32_0_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function sum_odd_squares(tree) {\n   if (is_empty_list(tree))\n      return 0;\n   else if (! is_pair(tree))\n      return (is_odd(tree)) ? square(tree) : 0;\n   else return sum_odd_squares(head(tree))\n               +\n               sum_odd_squares(tail(tree));\n}','javascript_32_0','', event,1.0);window.eval('function square(x){return x*x};function is_odd(n){return n%2===1};');">function sum_odd_squares(tree) {
   if (is_empty_list(tree))
      return 0;
   else if (! is_pair(tree))
      return (is_odd(tree)) ? square(tree) : 0;
   else return sum_odd_squares(head(tree))
               +
               sum_odd_squares(tail(tree));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20sum_odd_squares(tree)%20%7B%0A%20%20%20if%20(is_empty_list(tree))%0A%20%20%20%20%20%20return%200;%0A%20%20%20else%20if%20(!%20is_pair(tree))%0A%20%20%20%20%20%20return%20(is_odd(tree))%20?%20square(tree)%20:%200;%0A%20%20%20else%20return%20sum_odd_squares(head(tree))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sum_odd_squares(tail(tree));%0A%7D&amp;hidden=function%20square(x)%7Breturn%20x*x%7D;function%20is_odd(n)%7Breturn%20n%2===1%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        
      </p>

      <p>
        On the surface, this
        function
        is very different from the following
        one, which constructs a list of all the even Fibonacci numbers
        ${\rm Fib}(k)$, where $k$ is less than or equal to a given integer $n$:
        <div class="snippet" id="javascript_32_1_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function even_fibs(n) {\n   function next(k) {\n      if (k &gt; n) \n         return [];\n      else {\n         var f = fib(k);\n         if (is_even(f)) \n            return pair(f,next(k+1));\n         else return next(k+1);\n      }\n   }\n   return next(0);\n}','javascript_32_1','', event,1.0);window.eval('function is_even(n){return n%2===0};function fib(n){if(n===0){return 0}else{if(n===1){return 1}else{return fib(n-1)+fib(n-2)}}};');">function even_fibs(n) {
   function next(k) {
      if (k &gt; n) 
         return [];
      else {
         var f = fib(k);
         if (is_even(f)) 
            return pair(f,next(k+1));
         else return next(k+1);
      }
   }
   return next(0);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20even_fibs(n)%20%7B%0A%20%20%20function%20next(k)%20%7B%0A%20%20%20%20%20%20if%20(k%20&amp;gt;%20n)%20%0A%20%20%20%20%20%20%20%20%20return%20%5B%5D;%0A%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20var%20f%20=%20fib(k);%0A%20%20%20%20%20%20%20%20%20if%20(is_even(f))%20%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20pair(f,next(k+1));%0A%20%20%20%20%20%20%20%20%20else%20return%20next(k+1);%0A%20%20%20%20%20%20%7D%0A%20%20%20%7D%0A%20%20%20return%20next(0);%0A%7D&amp;hidden=function%20is_even(n)%7Breturn%20n%2===0%7D;function%20fib(n)%7Bif(n===0)%7Breturn%200%7Delse%7Bif(n===1)%7Breturn%201%7Delse%7Breturn%20fib(n-1)+fib(n-2)%7D%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

      </p>

      <p>
        Despite the fact that these two
        functions
        are structurally very
        different, a more abstract description of the two computations reveals
        a great deal of similarity.  The first program
        <UL>
          <LI>enumerates the leaves of a tree;
          </LI>
          <LI>filters them, selecting the odd ones;
          </LI>
          <LI>squares each of the selected ones; and
          </LI>
          <LI>accumulates the results using <kbd>+</kbd>, starting with 0.
          </LI>
        </UL>
      </p>

      <p>
        The second program
        <UL>
          <LI>enumerates the integers from 0 to $n$;
          </LI>
          <LI>computes the Fibonacci number for each integer;
          </LI>
          <LI>filters them, selecting the even ones; and
          </LI>
          <LI>accumulates the results using <kbd>pair</kbd>,  starting with the
            empty list.
          </LI>
        </UL>
      </p>

      <p>
        
        
        A signal-processing engineer would find it natural to conceptualize
        these processes in terms of signals flowing through a cascade of
        stages, each of which implements part of the program plan, as shown in
        Figure <REF NAME="fig:signal-flow-plans"></REF>.  In <kbd>sum_odd_squares</kbd>, we
        begin with an 
        
        <EM>enumerator</EM>, which generates a <QUOTE>signal</QUOTE>
        consisting of the leaves of a given tree.  This signal is passed
        through a 
        
        <EM>filter</EM>, which eliminates all but the odd elements.
        The resulting signal is in turn passed through a 
        
        <EM>map</EM>, which is a
        <QUOTE>transducer</QUOTE> that applies the <kbd>square</kbd>
        function
        to each
        element.  The output of the map is then fed to an 
        
        <EM>accumulator</EM>,
        which combines the elements using <kbd>+</kbd>, starting from an initial 0.
        The plan for <kbd>even_fibs</kbd> is analogous.


              <img src="img_original/ch2-Z-G-17.gif">
      </p>

      <p>
        Unfortunately, the two
        function
        definitions above fail to exhibit this
        signal-flow structure.  For instance, if we examine the <kbd>sum_odd_squares</kbd>
        function, we find that the enumeration is
        implemented partly by the <kbd>is_empty_list</kbd> and <kbd>is_pair</kbd> tests and partly
        by the tree-recursive structure of the
        function.  Similarly, the
        accumulation is found partly in the tests and partly in the addition used
        in the recursion.  In general, there are no distinct parts of either
        function
        that correspond to the elements in the signal-flow
        description.
        Our two
        functions
        decompose the computations in a different way,
        spreading the enumeration over the program and mingling it with the
        map, the filter, and the accumulation.  If we could organize our
        programs to make the signal-flow structure manifest in the
        functions
        we write, this would increase the conceptual clarity of the resulting
        code.
      </p>

      <h2>
        Sequence Operations
      </h2>

      
      

      <p>
        The key to organizing programs so as to more clearly reflect the
        signal-flow structure is to concentrate on the <QUOTE>signals</QUOTE> that flow
        from one stage in the process to the next.  If we represent these
        signals as lists, then we can use list operations to implement the
        processing at each of the stages.  For instance, we can implement the
        mapping stages of the signal-flow diagrams using the <kbd>map</kbd>
        function
        from Section <REF NAME="sec:sequences"></REF>:
        <div class="snippet" id="javascript_32_2_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('map(square,list(1,2,3,4,5))','javascript_32_2','', event,1.0);window.eval('function square(x){return x*x};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};');">map(square,list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=map(square,list(1,2,3,4,5))&amp;hidden=function%20square(x)%7Breturn%20x*x%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        Filtering a sequence to select only those elements that satisfy a
        given predicate is accomplished by
        <div class="snippet" id="javascript_32_3_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function filter(predicate,sequence) {\n   if (is_empty_list(sequence))\n      return [];\n   else if (predicate(head(sequence))) \n      return pair(head(sequence),\n                  filter(predicate,tail(sequence)));\n   else \n      return filter(predicate,tail(sequence));\n}','javascript_32_3','', event,1.0);window.eval('');">function filter(predicate,sequence) {
   if (is_empty_list(sequence))
      return [];
   else if (predicate(head(sequence))) 
      return pair(head(sequence),
                  filter(predicate,tail(sequence)));
   else 
      return filter(predicate,tail(sequence));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20filter(predicate,sequence)%20%7B%0A%20%20%20if%20(is_empty_list(sequence))%0A%20%20%20%20%20%20return%20%5B%5D;%0A%20%20%20else%20if%20(predicate(head(sequence)))%20%0A%20%20%20%20%20%20return%20pair(head(sequence),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filter(predicate,tail(sequence)));%0A%20%20%20else%20%0A%20%20%20%20%20%20return%20filter(predicate,tail(sequence));%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

      </p>

      <p>
        For example,
        <div class="snippet" id="javascript_32_4_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('filter(is_odd,list(1,2,3,4,5))','javascript_32_4','', event,1.0);window.eval('function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function is_odd(n){return n%2===1};');">filter(is_odd,list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=filter(is_odd,list(1,2,3,4,5))&amp;hidden=function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20is_odd(n)%7Breturn%20n%2===1%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>


        Accumulations can be implemented by
        
        <div class="snippet" id="javascript_32_5_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function accumulate(op,initial,sequence) {\n   if (is_empty_list(sequence))\n      return initial;\n   else \n      return op(head(sequence),\n                accumulate(op,initial,tail(sequence)));\n}','javascript_32_5','', event,1.0);window.eval('');">function accumulate(op,initial,sequence) {
   if (is_empty_list(sequence))
      return initial;
   else 
      return op(head(sequence),
                accumulate(op,initial,tail(sequence)));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20accumulate(op,initial,sequence)%20%7B%0A%20%20%20if%20(is_empty_list(sequence))%0A%20%20%20%20%20%20return%20initial;%0A%20%20%20else%20%0A%20%20%20%20%20%20return%20op(head(sequence),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20accumulate(op,initial,tail(sequence)));%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

        <div class="snippet" id="javascript_32_6_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('accumulate(plus,0,list(1,2,3,4,5))','javascript_32_6','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function plus(x,y){return x+y};');">accumulate(plus,0,list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=accumulate(plus,0,list(1,2,3,4,5))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20plus(x,y)%7Breturn%20x+y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        


        <div class="snippet" id="javascript_32_7_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('accumulate(times,1,list(1,2,3,4,5))','javascript_32_7','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function times(x,y){return x*y};');">accumulate(times,1,list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=accumulate(times,1,list(1,2,3,4,5))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20times(x,y)%7Breturn%20x*y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        <div class="snippet" id="javascript_32_8_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('accumulate(pair,[],list(1,2,3,4,5))','javascript_32_8','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};');">accumulate(pair,[],list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=accumulate(pair,%5B%5D,list(1,2,3,4,5))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        All that remains to implement signal-flow diagrams is to enumerate the
        sequence of elements to be processed.  For <kbd>even_fibs</kbd>, we need to
        generate the sequence of
        integers in a given range, which we can do as follows:
        <div class="snippet" id="javascript_32_9_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function enumerate_interval(low,high) {\n   if (low &gt; high)\n      return [];\n   else \n      return pair(low,\n                  enumerate_interval(low+1,high));\n}','javascript_32_9','', event,1.0);window.eval('');">function enumerate_interval(low,high) {
   if (low &gt; high)
      return [];
   else 
      return pair(low,
                  enumerate_interval(low+1,high));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20enumerate_interval(low,high)%20%7B%0A%20%20%20if%20(low%20&amp;gt;%20high)%0A%20%20%20%20%20%20return%20%5B%5D;%0A%20%20%20else%20%0A%20%20%20%20%20%20return%20pair(low,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(low+1,high));%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        <div class="snippet" id="javascript_32_10_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('enumerate_interval(2,7)','javascript_32_10','', event,1.0);window.eval('function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};');">enumerate_interval(2,7)</pre>
<a href="http://source-ide-new.surge.sh/?snippet=enumerate_interval(2,7)&amp;hidden=function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        To enumerate the leaves of a tree, we can use<a class="superscript" id="footnote-link-1" href="32.html#footnote-1">[1]</a>

            

        <div class="snippet" id="javascript_32_11_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function enumerate_tree(tree) {\n   if (is_empty_list(tree)) \n      return [];\n   else if (! is_pair(tree))\n      return list(tree);\n   else \n      return append(enumerate_tree(head(tree)),\n                    enumerate_tree(tail(tree)));\n}','javascript_32_11','', event,1.0);window.eval('function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};');">function enumerate_tree(tree) {
   if (is_empty_list(tree)) 
      return [];
   else if (! is_pair(tree))
      return list(tree);
   else 
      return append(enumerate_tree(head(tree)),
                    enumerate_tree(tail(tree)));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20enumerate_tree(tree)%20%7B%0A%20%20%20if%20(is_empty_list(tree))%20%0A%20%20%20%20%20%20return%20%5B%5D;%0A%20%20%20else%20if%20(!%20is_pair(tree))%0A%20%20%20%20%20%20return%20list(tree);%0A%20%20%20else%20%0A%20%20%20%20%20%20return%20append(enumerate_tree(head(tree)),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_tree(tail(tree)));%0A%7D&amp;hidden=function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        <div class="snippet" id="javascript_32_12_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('enumerate_tree(list(1,list(2,list(3,4)),5))','javascript_32_12','', event,1.0);window.eval('function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function enumerate_tree(tree){if(is_empty_list(tree)){return[]}else{if(!is_pair(tree)){return list(tree)}else{return append(enumerate_tree(head(tree)),enumerate_tree(tail(tree)))}}};');">enumerate_tree(list(1,list(2,list(3,4)),5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=enumerate_tree(list(1,list(2,list(3,4)),5))&amp;hidden=function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20enumerate_tree(tree)%7Bif(is_empty_list(tree))%7Breturn%5B%5D%7Delse%7Bif(!is_pair(tree))%7Breturn%20list(tree)%7Delse%7Breturn%20append(enumerate_tree(head(tree)),enumerate_tree(tail(tree)))%7D%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        Now we can reformulate <kbd>sum_odd_squares</kbd> and <kbd>even_fibs</kbd> as in
        the signal-flow diagrams.  For <kbd>sum_odd_squares</kbd>, we enumerate the
        sequence of leaves of the tree, filter this to keep only the odd
        numbers in the sequence, square each element, and sum the results:
        <div class="snippet" id="javascript_32_13_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function sum_odd_squares(tree) {\n   return accumulate(plus,\n                     0,\n                     map(square,\n                         filter(is_odd,\n                                enumerate_tree(tree))));\n}','javascript_32_13','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function square(x){return x*x};function plus(x,y){return x+y};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function is_odd(n){return n%2===1};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function enumerate_tree(tree){if(is_empty_list(tree)){return[]}else{if(!is_pair(tree)){return list(tree)}else{return append(enumerate_tree(head(tree)),enumerate_tree(tail(tree)))}}};');">function sum_odd_squares(tree) {
   return accumulate(plus,
                     0,
                     map(square,
                         filter(is_odd,
                                enumerate_tree(tree))));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20sum_odd_squares(tree)%20%7B%0A%20%20%20return%20accumulate(plus,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(square,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filter(is_odd,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_tree(tree))));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20plus(x,y)%7Breturn%20x+y%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20is_odd(n)%7Breturn%20n%2===1%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20enumerate_tree(tree)%7Bif(is_empty_list(tree))%7Breturn%5B%5D%7Delse%7Bif(!is_pair(tree))%7Breturn%20list(tree)%7Delse%7Breturn%20append(enumerate_tree(head(tree)),enumerate_tree(tail(tree)))%7D%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        For <kbd>even_fibs</kbd>, we enumerate the integers from 0 to $n$, generate
        the Fibonacci number for each of these integers, filter the resulting
        sequence to keep only the even elements, and accumulate the results
        into a list:
        <div class="snippet" id="javascript_32_14_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function even_fibs(n) {\n   return accumulate(pair,\n                     [],\n                     filter(is_even,\n                            map(fib,\n                                enumerate_interval(0,n))));\n}','javascript_32_14','', event,1.0);window.eval('function is_even(n){return n%2===0};function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function fib(n){if(n===0){return 0}else{if(n===1){return 1}else{return fib(n-1)+fib(n-2)}}};function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};');">function even_fibs(n) {
   return accumulate(pair,
                     [],
                     filter(is_even,
                            map(fib,
                                enumerate_interval(0,n))));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20even_fibs(n)%20%7B%0A%20%20%20return%20accumulate(pair,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%5D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filter(is_even,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(fib,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(0,n))));%0A%7D&amp;hidden=function%20is_even(n)%7Breturn%20n%2===0%7D;function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20fib(n)%7Bif(n===0)%7Breturn%200%7Delse%7Bif(n===1)%7Breturn%201%7Delse%7Breturn%20fib(n-1)+fib(n-2)%7D%7D%7D;function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        The value of expressing programs as sequence operations is that this
        helps us make program designs that are modular, that is, designs that
        are constructed by combining relatively independent pieces.  We can
        encourage modular design by providing a library of standard components
        together with a conventional interface for connecting the components
        in flexible ways.
      </p>

      <p>
        
        
        Modular construction is a powerful strategy for
        controlling complexity in engineering design.  In real
        signal-processing applications, for example, designers regularly build
        systems by cascading elements selected from standardized families of
        filters and transducers.  Similarly, sequence operations provide a
        library of standard program elements that we can mix and match.  For
        instance, we can reuse pieces from the <kbd>sum_odd_squares</kbd> and <kbd>even-fibs</kbd>
        functions
        in a program that constructs a list of the
        squares of the first $n+1$ Fibonacci numbers:
        <div class="snippet" id="javascript_32_15_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function list_fib_squares(n) {\n   return accumulate(pair,\n                     [],\n                     map(square,\n                         map(fib,\n                             enumerate_interval(0,n))));\n}','javascript_32_15','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function square(x){return x*x};function fib(n){if(n===0){return 0}else{if(n===1){return 1}else{return fib(n-1)+fib(n-2)}}};function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};');">function list_fib_squares(n) {
   return accumulate(pair,
                     [],
                     map(square,
                         map(fib,
                             enumerate_interval(0,n))));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20list_fib_squares(n)%20%7B%0A%20%20%20return%20accumulate(pair,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%5D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(square,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(fib,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(0,n))));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20fib(n)%7Bif(n===0)%7Breturn%200%7Delse%7Bif(n===1)%7Breturn%201%7Delse%7Breturn%20fib(n-1)+fib(n-2)%7D%7D%7D;function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        <div class="snippet" id="javascript_32_16_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('list_fib_squares(10)','javascript_32_16','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function square(x){return x*x};function fib(n){if(n===0){return 0}else{if(n===1){return 1}else{return fib(n-1)+fib(n-2)}}};function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};function list_fib_squares(n){return accumulate(pair,[],map(square,map(fib,enumerate_interval(0,n))))};');">list_fib_squares(10)</pre>
<a href="http://source-ide-new.surge.sh/?snippet=list_fib_squares(10)&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20fib(n)%7Bif(n===0)%7Breturn%200%7Delse%7Bif(n===1)%7Breturn%201%7Delse%7Breturn%20fib(n-1)+fib(n-2)%7D%7D%7D;function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;function%20list_fib_squares(n)%7Breturn%20accumulate(pair,%5B%5D,map(square,map(fib,enumerate_interval(0,n))))%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        We can rearrange the pieces and use them in computing the product of
        the odd integers in a sequence:
        <div class="snippet" id="javascript_32_17_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function product_of_squares_of_odd_elements(sequence) {\n   return accumulate(times,\n                     1,\n                     map(square,\n                         filter(is_odd,sequence)));\n}','javascript_32_17','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function square(x){return x*x};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function is_odd(n){return n%2===1};function times(x,y){return x*y};');">function product_of_squares_of_odd_elements(sequence) {
   return accumulate(times,
                     1,
                     map(square,
                         filter(is_odd,sequence)));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20product_of_squares_of_odd_elements(sequence)%20%7B%0A%20%20%20return%20accumulate(times,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(square,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20filter(is_odd,sequence)));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20is_odd(n)%7Breturn%20n%2===1%7D;function%20times(x,y)%7Breturn%20x*y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        <div class="snippet" id="javascript_32_18_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('product_of_squares_of_odd_elements(list(1,2,3,4,5))','javascript_32_18','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function square(x){return x*x};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function is_odd(n){return n%2===1};function times(x,y){return x*y};function product_of_squares_of_odd_elements(sequence){return accumulate(times,1,map(square,filter(is_odd,sequence)))};');">product_of_squares_of_odd_elements(list(1,2,3,4,5))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=product_of_squares_of_odd_elements(list(1,2,3,4,5))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20is_odd(n)%7Breturn%20n%2===1%7D;function%20times(x,y)%7Breturn%20x*y%7D;function%20product_of_squares_of_odd_elements(sequence)%7Breturn%20accumulate(times,1,map(square,filter(is_odd,sequence)))%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        We can also formulate conventional data-processing applications in
        terms of sequence operations.  Suppose we have a sequence of personnel
        records and we want to find the salary of the highest-paid programmer.
        Assume that we have a selector <kbd>salary</kbd> that returns the salary of
        a record, and a predicate <kbd>is_programmer</kbd> that tests if a record is
        for a programmer.  Then we can write
        <kbd EVAL="no" class="snippet">function salary_of_highest_paid_programmer(records) {
   return accumulate(Math.max,
                     0,
                     map(salary,
                         filter(is_programmer,records)));
}</kbd>
      </p>

      <p>
        These examples give just a hint of the vast range of operations that
        can be expressed as sequence operations.<a class="superscript" id="footnote-link-2" href="32.html#footnote-2">[2]</a>
      </p>

      <p>
        Sequences, implemented here as lists, serve
        as a conventional interface that permits us to combine processing
        modules.  Additionally, when we uniformly represent structures as
        sequences, we have localized the data-structure dependencies in our
        programs to a small number of sequence operations.  By changing these,
        we can experiment with alternative representations of sequences, while
        leaving the overall design of our programs intact.  We will exploit
        this capability in Section <REF NAME="sec:streams"></REF>, when we generalize the
        sequence-processing paradigm to admit infinite sequences.
      </p>

      <EXERCISE>
        Fill in the missing expressions to complete the following definitions
        of some basic list-manipulation operations as accumulations:
        <div class="snippet" id="javascript_32_19_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function map(p,sequence) {\n   return accumulate(function(x,y) { ?? }, \n                     [], sequence);\n}\n\nfunction append(seq1,seq2) {\n   return accumulate(pair, ??, ??);\n}\n\nfunction length(sequence) {\n   return accumulate(??, 0, sequence);\n}','javascript_32_19','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};');">function map(p,sequence) {
   return accumulate(function(x,y) { ?? }, 
                     [], sequence);
}

function append(seq1,seq2) {
   return accumulate(pair, ??, ??);
}

function length(sequence) {
   return accumulate(??, 0, sequence);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20map(p,sequence)%20%7B%0A%20%20%20return%20accumulate(function(x,y)%20%7B%20??%20%7D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%5D,%20sequence);%0A%7D%0A%0Afunction%20append(seq1,seq2)%20%7B%0A%20%20%20return%20accumulate(pair,%20??,%20??);%0A%7D%0A%0Afunction%20length(sequence)%20%7B%0A%20%20%20return%20accumulate(??,%200,%20sequence);%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
    
      </EXERCISE>

      <EXERCISE>
        
        Evaluating a polynomial in $x$ at a given value of $x$ can be
        formulated as an accumulation.  We evaluate the polynomial
        
          \[ a_{n} x^n +a_{n-1}x^{n-1}+\cdots + a_{1} x+a_{0} \]
        
        using a well-known algorithm called 
        
        <EM>Horner's rule</EM>, which
        structures the computation as
        
          \[ \left(\cdots (a_{n}  x+a_{n-1})x+\cdots +a_{1}\right) x+a_{0} \]
        
        In other words, we start with $a_{n}$, multiply by $x$, add $a_{n-1}$,
        multiply by $x$, and so on, until we reach $a_{0}$.<a class="superscript" id="footnote-link-3" href="32.html#footnote-3">[3]</a>

        Fill in the following template to produce a
        function
        that evaluates a
        polynomial using Horner's rule.
        Assume that the coefficients of the
        polynomial are arranged in a sequence, from $a_{0}$ through $a_{n}$.
        <div class="snippet" id="javascript_32_20_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function horner_eval(x,coefficient_sequence) {\n   return accumulate(function(this_coeff,\n                              higher_terms) { \n                        ?? \n                     },\n                     0,\n                     coefficient_sequence);\n}','javascript_32_20','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};');">function horner_eval(x,coefficient_sequence) {
   return accumulate(function(this_coeff,
                              higher_terms) { 
                        ?? 
                     },
                     0,
                     coefficient_sequence);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20horner_eval(x,coefficient_sequence)%20%7B%0A%20%20%20return%20accumulate(function(this_coeff,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20higher_terms)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20??%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20coefficient_sequence);%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        For example, to compute $1+3x+5x^3+x^5$ at $x=2$ you would evaluate
        <div class="snippet" id="javascript_32_21_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('horner_eval(2,list(1,3,0,5,0,1))','javascript_32_21','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};\nfunction horner_eval(x,coefficient_sequence) {\n   return accumulate(function(this_coeff,\n                              higher_terms) { \n                        ?? \n                     },\n                     0,\n                     coefficient_sequence);\n}\n        ');">horner_eval(2,list(1,3,0,5,0,1))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=horner_eval(2,list(1,3,0,5,0,1))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;%0Afunction%20horner_eval(x,coefficient_sequence)%20%7B%0A%20%20%20return%20accumulate(function(this_coeff,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20higher_terms)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20??%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20coefficient_sequence);%0A%7D%0A%20%20%20%20%20%20%20%20" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
    
      </EXERCISE>

      <EXERCISE>
        Redefine <kbd>count_leaves</kbd> from Section <REF NAME="sec:trees"></REF> as an
        accumulation:
        <div class="snippet" id="javascript_32_22_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function count_leaves(t) {\n   return accumulate(??, ??, map(??, ??));\n}','javascript_32_22','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};');">function count_leaves(t) {
   return accumulate(??, ??, map(??, ??));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20count_leaves(t)%20%7B%0A%20%20%20return%20accumulate(??,%20??,%20map(??,%20??));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
    
      </EXERCISE>

      <EXERCISE>
        The
        function
        <kbd>accumulate_n</kbd> is similar to <kbd>accumulate</kbd> except
        that it takes as its third argument a sequence of sequences, which are all
        assumed to have the same number of elements.  It applies the
        designated accumulation
        function
        to combine all the first elements of
        the sequences, all the second elements of the sequences, and so on, and
        returns a sequence of the results.  For instance, if <kbd>s</kbd> is a sequence
         containing four sequences, <kbd>[[1,[2,[3,[]]]],[[4,[5,[6,[]]]],[[7,[8,[9,[]]]],[[10,[11,[12,[]]]],[]]]]]</kbd>
        then the value of <kbd>accumulate_n(plus,0,s)</kbd> should be the sequence <kbd>[22,[26,[30,[]]]]</kbd>.  Fill in the missing expressions
        in the following definition of <kbd>accumulate_n</kbd>:
        <div class="snippet" id="javascript_32_23_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function accumulate_n(op,init,seqs) {\n   if (is_empty_list(head(seqs)))\n      return [];\n   else \n      return pair(accumulate(op,init,??),\n                  accumulate_n(op,init,??));\n}','javascript_32_23','', event,1.0);window.eval('');">function accumulate_n(op,init,seqs) {
   if (is_empty_list(head(seqs)))
      return [];
   else 
      return pair(accumulate(op,init,??),
                  accumulate_n(op,init,??));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20accumulate_n(op,init,seqs)%20%7B%0A%20%20%20if%20(is_empty_list(head(seqs)))%0A%20%20%20%20%20%20return%20%5B%5D;%0A%20%20%20else%20%0A%20%20%20%20%20%20return%20pair(accumulate(op,init,??),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20accumulate_n(op,init,??));%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
    
    
    </EXERCISE>

      <EXERCISE>
        
        
        
        Suppose we represent vectors $v=(v_{i})$ as sequences of numbers, and
        matrices $m=(m_{ij})$ as sequences of vectors (the rows of the matrix).
        For example, the matrix
        
          \[ \left[ 
          \begin{array}{llll}
          1 &amp; 2 &amp; 3 &amp; 4\\
          4 &amp; 5 &amp; 6 &amp; 6\\
          6 &amp; 7 &amp; 8 &amp; 9\\
          \end{array}
          \right] \]
        
        is represented as the sequence <kbd>[[1,[2,[3,[4,[]]]]],[[4,[5,[6,[6,[]]]]],[[6,[7,[8,[9,[]]]]],[]]]]</kbd>.
        With this representation, we can use sequence operations to concisely
        express the basic matrix and vector operations.  These operations
        (which are described in any book on matrix algebra) are the following:


        <UL>
          <LI>
          <kbd>dot_product(</kbd>$v$<kbd>,</kbd>$w$<kbd>)</kbd> returns the sum $\sum_{i}v_{i}
            w_{i}$.
          </LI>
          <LI>
            <kbd>matrix_times_vector(</kbd>$m$<kbd>,</kbd>$v$<kbd>)</kbd> returns the vector $t$, where $t_{i} =\sum_{j}m_{ij}v_{j}$.
          </LI>
          <LI>
            <kbd>matrix_times_matrix(</kbd>$m$<kbd>,</kbd>$n$<kbd>)</kbd> returns the matrix $p$, where $p_{ij}=\sum_{k} m_{ik}n_{kj}$.
          </LI>
          <LI>
            <kbd>transpose(</kbd>$m$<kbd>)</kbd> returns the matrix $n$, where $n_{ij}=m_{ji}$.
          </LI>
        </UL>
        We can define the dot product as<a class="superscript" id="footnote-link-4" href="32.html#footnote-4">[4]</a>
        <div class="snippet" id="javascript_32_24_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function dot_product(v,w) {\n   return accumulate(plus,0,map(times,v,w));\n}','javascript_32_24','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function plus(x,y){return x+y};function times(x,y){return x*y};');">function dot_product(v,w) {
   return accumulate(plus,0,map(times,v,w));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20dot_product(v,w)%20%7B%0A%20%20%20return%20accumulate(plus,0,map(times,v,w));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20plus(x,y)%7Breturn%20x+y%7D;function%20times(x,y)%7Breturn%20x*y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        

        Fill in the missing expressions in the following
        functions
        for
        computing the other matrix operations.  (The
        function
        <kbd>accumulate_n</kbd> is
        defined in Exercise <REF NAME="ex:accumulate-n"></REF>.)
        <div class="snippet" id="javascript_32_25_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function matrix_times_vector(m,v) {\n   return map(??,m);\n}\n\nfunction transpose(mat) {\n   return accumulate_n(??,??,mat);\n}\n\nfunction matrix_times_matrix(n,m) {\n   var cols = transpose(n);\n   return map(??,m);\n}','javascript_32_25','', event,1.0);window.eval('');">function matrix_times_vector(m,v) {
   return map(??,m);
}

function transpose(mat) {
   return accumulate_n(??,??,mat);
}

function matrix_times_matrix(n,m) {
   var cols = transpose(n);
   return map(??,m);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20matrix_times_vector(m,v)%20%7B%0A%20%20%20return%20map(??,m);%0A%7D%0A%0Afunction%20transpose(mat)%20%7B%0A%20%20%20return%20accumulate_n(??,??,mat);%0A%7D%0A%0Afunction%20matrix_times_matrix(n,m)%20%7B%0A%20%20%20var%20cols%20=%20transpose(n);%0A%20%20%20return%20map(??,m);%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
    
    
      </EXERCISE>

      <EXERCISE>
        
        
        The <kbd>accumulate</kbd>
        function
        is also known as <kbd>fold_right</kbd>,
        because it combines the first element of the sequence with the result
        of combining all the elements to the right.  There is also a <kbd>fold_left</kbd>, which is 
        similar to <kbd>fold_right</kbd>, except
        that it combines elements working in the opposite direction:
        <div class="snippet" id="javascript_32_26_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function fold_left(op,initial,sequence) {\n   function iter(result,rest) {\n      if (is_empty_list(rest)) \n         return result;\n      else\n         return iter(op(result,head(rest)),\n                     tail(rest));\n   }\n   return iter(initial,sequence);\n}','javascript_32_26','', event,1.0);window.eval('');">function fold_left(op,initial,sequence) {
   function iter(result,rest) {
      if (is_empty_list(rest)) 
         return result;
      else
         return iter(op(result,head(rest)),
                     tail(rest));
   }
   return iter(initial,sequence);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20fold_left(op,initial,sequence)%20%7B%0A%20%20%20function%20iter(result,rest)%20%7B%0A%20%20%20%20%20%20if%20(is_empty_list(rest))%20%0A%20%20%20%20%20%20%20%20%20return%20result;%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20return%20iter(op(result,head(rest)),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tail(rest));%0A%20%20%20%7D%0A%20%20%20return%20iter(initial,sequence);%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

        What are the values of
        
        <div class="snippet" id="javascript_32_27_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('fold_right(divide,1,list(1,2,3))','javascript_32_27','', event,1.0);window.eval('function fold_right(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),fold_right(op,initial,tail(sequence)))}};function divide(x,y){return x/y};');">fold_right(divide,1,list(1,2,3))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=fold_right(divide,1,list(1,2,3))&amp;hidden=function%20fold_right(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),fold_right(op,initial,tail(sequence)))%7D%7D;function%20divide(x,y)%7Breturn%20x/y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        <div class="snippet" id="javascript_32_28_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('fold_left(divide,1,list(1,2,3))','javascript_32_28','', event,1.0);window.eval('function fold_left(op,initial,sequence){function iter(result,rest){if(is_empty_list(rest)){return result}else{return iter(op(result,head(rest)),tail(rest))}}return iter(initial,sequence)};function divide(x,y){return x/y};');">fold_left(divide,1,list(1,2,3))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=fold_left(divide,1,list(1,2,3))&amp;hidden=function%20fold_left(op,initial,sequence)%7Bfunction%20iter(result,rest)%7Bif(is_empty_list(rest))%7Breturn%20result%7Delse%7Breturn%20iter(op(result,head(rest)),tail(rest))%7D%7Dreturn%20iter(initial,sequence)%7D;function%20divide(x,y)%7Breturn%20x/y%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        <div class="snippet" id="javascript_32_29_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('fold_right(list,[],list(1,2,3))','javascript_32_29','', event,1.0);window.eval('function fold_right(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),fold_right(op,initial,tail(sequence)))}};');">fold_right(list,[],list(1,2,3))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=fold_right(list,%5B%5D,list(1,2,3))&amp;hidden=function%20fold_right(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),fold_right(op,initial,tail(sequence)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        <div class="snippet" id="javascript_32_30_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('fold_left(list,[],list(1,2,3))','javascript_32_30','', event,1.0);window.eval('function fold_left(op,initial,sequence){function iter(result,rest){if(is_empty_list(rest)){return result}else{return iter(op(result,head(rest)),tail(rest))}}return iter(initial,sequence)};');">fold_left(list,[],list(1,2,3))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=fold_left(list,%5B%5D,list(1,2,3))&amp;hidden=function%20fold_left(op,initial,sequence)%7Bfunction%20iter(result,rest)%7Bif(is_empty_list(rest))%7Breturn%20result%7Delse%7Breturn%20iter(op(result,head(rest)),tail(rest))%7D%7Dreturn%20iter(initial,sequence)%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        Give a property that <kbd>op</kbd> should satisfy to guarantee that <kbd>fold_right</kbd> and <kbd>fold_left</kbd> will produce the same values for any
        sequence.
        
    
      </EXERCISE>

      <EXERCISE>
        Complete the following definitions of <kbd>reverse</kbd>
        
        (Exercise <REF NAME="ex:reverse"></REF>) in terms of <kbd>fold_right</kbd> and <kbd>fold_left</kbd> from Exercise <REF NAME="ex:fold-right-left"></REF>:
        <div class="snippet" id="javascript_32_31_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function reverse(sequence) {\n   return fold_right(function(x,y) { ?? },[],sequence);\n}\n\nfunction reverse(sequence) {\n   return fold_left(function(x,y) { ?? },[],sequence);','javascript_32_31','', event,1.0);window.eval('');">function reverse(sequence) {
   return fold_right(function(x,y) { ?? },[],sequence);
}

function reverse(sequence) {
   return fold_left(function(x,y) { ?? },[],sequence);</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20reverse(sequence)%20%7B%0A%20%20%20return%20fold_right(function(x,y)%20%7B%20??%20%7D,%5B%5D,sequence);%0A%7D%0A%0Afunction%20reverse(sequence)%20%7B%0A%20%20%20return%20fold_left(function(x,y)%20%7B%20??%20%7D,%5B%5D,sequence);&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

      </EXERCISE>
      

      <h2>
        Nested Mappings
      </h2>

      
      

      <p>
        We can extend the sequence paradigm to include many
        computations that are commonly expressed using nested 
        loops.<a class="superscript" id="footnote-link-5" href="32.html#footnote-5">[5]</a>
      </p>

      <p>
        Consider
        this problem: Given a positive integer $n$, find all ordered pairs of
        distinct positive integers $i$ and $j$, where $1\leq j&lt; i\leq n$, such
        that $i +j$ is prime.  For example, if $n$ is 6, then the pairs are
        the following:
        
          \[
          \begin{array}{c|ccccccc}
          i     &amp; 2 &amp; 3 &amp; 4 &amp; 4 &amp; 5 &amp; 6 &amp; 6 \\
          j     &amp; 1 &amp; 2 &amp; 1 &amp; 3 &amp; 2 &amp; 1 &amp; 5 \\
          \hline
          i+j   &amp; 3 &amp; 5 &amp; 5 &amp; 7 &amp; 7 &amp; 7 &amp; 11
          \end{array}
          \]
        
      </p>

      <p>
        A natural way to organize this computation is to generate the sequence
        of all ordered pairs of positive integers less than or equal to $n$,
        filter to select those pairs whose sum is prime, and
        then, for each pair $(i, j)$ that passes through the filter, produce the triple
        $(i,j,i+j)$.
      </p>

      <p>
        Here is a way to generate the sequence of pairs: For each integer
        $i\leq n$, enumerate the integers $j&lt;i$, and for each such $i$ and $j$
        generate the pair $(i,j)$.  In terms of sequence operations, we map
        along the sequence <kbd>enumerate_interval(1,n)</kbd>.  For each $i$ in
        this sequence, we map along the sequence <kbd>enumerate_interval(1,i-1)</kbd>.  For each $j$ in this latter sequence, we generate the pair
        <kbd>list(i,j)</kbd>.  This gives us a sequence of pairs for each $i$.
        Combining all the sequences for all the $i$ (by accumulating with <kbd>append</kbd>) produces the required sequence of pairs:<a class="superscript" id="footnote-link-6" href="32.html#footnote-6">[6]</a>

        

        <div class="snippet" id="javascript_32_32_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('accumulate(append,\n           [],\n           map(function(i) {\n                  return \n                     map(function(j) { \n                            return list(i,j); \n                         },\n                         enumerate_interval(1,i-1))\n               },\n               enumerate_interval(1,n)))','javascript_32_32','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};\n// replace n below by the desired number\n        ');">accumulate(append,
           [],
           map(function(i) {
                  return 
                     map(function(j) { 
                            return list(i,j); 
                         },
                         enumerate_interval(1,i-1))
               },
               enumerate_interval(1,n)))</pre>
<a href="http://source-ide-new.surge.sh/?snippet=accumulate(append,%0A%20%20%20%20%20%20%20%20%20%20%20%5B%5D,%0A%20%20%20%20%20%20%20%20%20%20%20map(function(i)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20map(function(j)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20list(i,j);%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(1,i-1))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(1,n)))&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;%0A//%20replace%20n%20below%20by%20the%20desired%20number%0A%20%20%20%20%20%20%20%20" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
      </p>

      <p>
        The combination of mapping and accumulating with <kbd>append</kbd> is so common in this
        sort of program that we will isolate it as a separate
        function:
        <div class="snippet" id="javascript_32_33_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function flatmap(proc,seq) {\n   return accumulate(append,[],map(proc,seq));\n}','javascript_32_33','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};');">function flatmap(proc,seq) {
   return accumulate(append,[],map(proc,seq));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20flatmap(proc,seq)%20%7B%0A%20%20%20return%20accumulate(append,%5B%5D,map(proc,seq));%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        
      </p>

      <p>
        Now filter this sequence of pairs to find those whose sum is prime. The
        filter predicate is called for each element of the sequence; its
        argument is a pair and it must extract the integers from the pair.
        Thus, the predicate to apply to each element in the sequence is
        <div class="snippet" id="javascript_32_34_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function is_prime_sum(pair) {\n   return is_prime(head(pair)+head(tail(pair)));\n}','javascript_32_34','', event,1.0);window.eval('function square(x){return x*x};function smallest_divisor(n){return find_divisor(n,2)}function find_divisor(n,test_divisor){if(square(test_divisor)&gt;n){return n}else{if(divides(test_divisor,n)){return test_divisor}else{return find_divisor(n,test_divisor+1)}}}function divides(a,b){return b%a===0};function is_prime(n){return n===smallest_divisor(n)};');">function is_prime_sum(pair) {
   return is_prime(head(pair)+head(tail(pair)));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20is_prime_sum(pair)%20%7B%0A%20%20%20return%20is_prime(head(pair)+head(tail(pair)));%0A%7D&amp;hidden=function%20square(x)%7Breturn%20x*x%7D;function%20smallest_divisor(n)%7Breturn%20find_divisor(n,2)%7Dfunction%20find_divisor(n,test_divisor)%7Bif(square(test_divisor)&amp;gt;n)%7Breturn%20n%7Delse%7Bif(divides(test_divisor,n))%7Breturn%20test_divisor%7Delse%7Breturn%20find_divisor(n,test_divisor+1)%7D%7D%7Dfunction%20divides(a,b)%7Breturn%20b%a===0%7D;function%20is_prime(n)%7Breturn%20n===smallest_divisor(n)%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        
      </p>

      <p>
        Finally, generate the sequence of results by mapping over the filtered
        pairs using the following
        function, which constructs a triple
        consisting of the two elements of the pair along with their sum:
        <div class="snippet" id="javascript_32_35_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function make_pair_sum(pair) {\n   return list(head(pair),head(tail(pair)),\n               head(pair)+head(tail(pair)));\n}','javascript_32_35','', event,1.0);window.eval('');">function make_pair_sum(pair) {
   return list(head(pair),head(tail(pair)),
               head(pair)+head(tail(pair)));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20make_pair_sum(pair)%20%7B%0A%20%20%20return%20list(head(pair),head(tail(pair)),%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20head(pair)+head(tail(pair)));%0A%7D&amp;hidden=" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        
      </p>

      <p>
        Combining all these steps yields the complete
        function:
        <div class="snippet" id="javascript_32_36_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function prime_sum_pairs(n) {\n   return map(make_pair_sum,\n              filter(is_prime_sum,\n                     flatmap(function(i) {\n                                return map(function(j) { \n                                              return list(i,j);\n                                           },\n                                           enumerate_interval(1,i-1));\n                             },\n                             enumerate_interval(1,n))));\n}','javascript_32_36','', event,1.0);window.eval('function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function make_pair_sum(pair){return list(head(pair),head(tail(pair)),head(pair)+head(tail(pair)))};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function square(x){return x*x};function smallest_divisor(n){return find_divisor(n,2)}function find_divisor(n,test_divisor){if(square(test_divisor)&gt;n){return n}else{if(divides(test_divisor,n)){return test_divisor}else{return find_divisor(n,test_divisor+1)}}}function divides(a,b){return b%a===0};function is_prime(n){return n===smallest_divisor(n)};function is_prime_sum(pair){return is_prime(head(pair)+head(tail(pair)))};function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function flatmap(proc,seq){return accumulate(append,[],map(proc,seq))};function enumerate_interval(low,high){if(low&gt;high){return[]}else{return pair(low,enumerate_interval(low+1,high))}};');">function prime_sum_pairs(n) {
   return map(make_pair_sum,
              filter(is_prime_sum,
                     flatmap(function(i) {
                                return map(function(j) { 
                                              return list(i,j);
                                           },
                                           enumerate_interval(1,i-1));
                             },
                             enumerate_interval(1,n))));
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20prime_sum_pairs(n)%20%7B%0A%20%20%20return%20map(make_pair_sum,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20filter(is_prime_sum,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20flatmap(function(i)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20map(function(j)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20list(i,j);%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(1,i-1));%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(1,n))));%0A%7D&amp;hidden=function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20make_pair_sum(pair)%7Breturn%20list(head(pair),head(tail(pair)),head(pair)+head(tail(pair)))%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20square(x)%7Breturn%20x*x%7D;function%20smallest_divisor(n)%7Breturn%20find_divisor(n,2)%7Dfunction%20find_divisor(n,test_divisor)%7Bif(square(test_divisor)&amp;gt;n)%7Breturn%20n%7Delse%7Bif(divides(test_divisor,n))%7Breturn%20test_divisor%7Delse%7Breturn%20find_divisor(n,test_divisor+1)%7D%7D%7Dfunction%20divides(a,b)%7Breturn%20b%a===0%7D;function%20is_prime(n)%7Breturn%20n===smallest_divisor(n)%7D;function%20is_prime_sum(pair)%7Breturn%20is_prime(head(pair)+head(tail(pair)))%7D;function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20flatmap(proc,seq)%7Breturn%20accumulate(append,%5B%5D,map(proc,seq))%7D;function%20enumerate_interval(low,high)%7Bif(low&amp;gt;high)%7Breturn%5B%5D%7Delse%7Breturn%20pair(low,enumerate_interval(low+1,high))%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

      </p>

      <p>
        Nested mappings are also useful for sequences other than those that
        enumerate intervals.  Suppose we wish to generate all the 
        
        
        permutations
        of a set $S$; that is, all the ways of ordering the items in
        the set.  For instance, the permutations of $\{1,2,3\}$ are
        $\{1,2,3\}$, $\{ 1,3,2\}$, $\{2,1,3\}$, $\{ 2,3,1\}$, $\{ 3,1,2\}$, and
        $\{ 3,2,1\}$.  Here is a plan for generating the permutations of $S$:
        For each item $x$ in $S$, recursively generate the sequence of
        permutations of $S-x$,<a class="superscript" id="footnote-link-7" href="32.html#footnote-7">[7]</a> and adjoin
        $x$ to the front of each one.  This yields, for each $x$ in $S$, the sequence
        of permutations of $S$ that begin with $x$.  Combining these
        sequences for all $x$ gives all the permutations of $S$:<a class="superscript" id="footnote-link-8" href="32.html#footnote-8">[8]</a>

        <div class="snippet" id="javascript_32_37_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function permutations(s) {\n   if (is_empty_list(s)) \n      return list([]);\n   else\n      return flatmap(function(x) {\n                        return map(function(p) { \n                                      return pair(x,p);\n                                   },\n                                   permutations(remove(x,s)));\n                     },\n                     s);\n}','javascript_32_37','', event,1.0);window.eval('function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function flatmap(proc,seq){return accumulate(append,[],map(proc,seq))};function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};function remove(item,sequence){return filter(function(x){return !(x===item)},sequence)};');">function permutations(s) {
   if (is_empty_list(s)) 
      return list([]);
   else
      return flatmap(function(x) {
                        return map(function(p) { 
                                      return pair(x,p);
                                   },
                                   permutations(remove(x,s)));
                     },
                     s);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20permutations(s)%20%7B%0A%20%20%20if%20(is_empty_list(s))%20%0A%20%20%20%20%20%20return%20list(%5B%5D);%0A%20%20%20else%0A%20%20%20%20%20%20return%20flatmap(function(x)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20map(function(p)%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20pair(x,p);%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20permutations(remove(x,s)));%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20s);%0A%7D&amp;hidden=function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20flatmap(proc,seq)%7Breturn%20accumulate(append,%5B%5D,map(proc,seq))%7D;function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;function%20remove(item,sequence)%7Breturn%20filter(function(x)%7Breturn%20!(x===item)%7D,sequence)%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        

      </p>

      <p>
        Notice how this strategy reduces the problem of generating
        permutations of $S$ to the problem of generating the permutations of
        sets with fewer elements than $S$.  In the terminal case, we work our
        way down to the empty list, which represents a set of no elements.
        For this, we generate <kbd>list([])</kbd>, which is a sequence with one
        item, namely the set with no elements.  The <kbd>remove</kbd>
        function
        used in <kbd>permutations</kbd> returns all the items in a given sequence
        except for a given item.  This can be expressed as a simple filter:
        <div class="snippet" id="javascript_32_38_div"></div><div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function remove(item,sequence) {\n   return filter(function(x) {\n                    return ! (x === item); \n                 },\n                 sequence);\n}','javascript_32_38','', event,1.0);window.eval('function filter(predicate,sequence){if(is_empty_list(sequence)){return[]}else{if(predicate(head(sequence))){return pair(head(sequence),filter(predicate,tail(sequence)))}else{return filter(predicate,tail(sequence))}}};');">function remove(item,sequence) {
   return filter(function(x) {
                    return ! (x === item); 
                 },
                 sequence);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20remove(item,sequence)%20%7B%0A%20%20%20return%20filter(function(x)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20!%20(x%20===%20item);%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sequence);%0A%7D&amp;hidden=function%20filter(predicate,sequence)%7Bif(is_empty_list(sequence))%7Breturn%5B%5D%7Delse%7Bif(predicate(head(sequence)))%7Breturn%20pair(head(sequence),filter(predicate,tail(sequence)))%7Delse%7Breturn%20filter(predicate,tail(sequence))%7D%7D%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>
        
      </p>

      <EXERCISE>
        Define a
        function

        
        <kbd>unique_pairs</kbd> that, given an integer $n$,
        generates the sequence of pairs $(i,j)$ with $1\leq j&lt; i\leq n$.  Use <kbd>unique_pairs</kbd> to simplify the definition of <kbd>prime_sum_pairs</kbd>
        given above.
    
    
      </EXERCISE>

      <EXERCISE>
        Write a
        function
        to find all ordered
        triples of distinct positive integers $i$, $j$, and $k$ less than or
        equal to a given integer $n$ that sum to a given integer $s$.
    
    
      </EXERCISE>

      <EXERCISE>


              <img src="img_original/ch2-Z-G-23.gif">
        The 
        
        
        <QUOTE>eight-queens puzzle</QUOTE> asks how to place eight queens on a
        chessboard so that no queen is in check from any other (i.e., no two
        queens are in the same row, column, or diagonal).  One possible
        solution is shown in Figure <REF NAME="fig:8queens"></REF>.  One way to solve the
        puzzle is to work across the board, placing a queen in each column.
        Once we have placed $k-1$ queens, we must place the $k$th queen in a
        position where it does not check any of the queens already on the
        board.  We can formulate this approach recursively: Assume that we
        have already generated the sequence of all possible ways to place
        $k-1$ queens in the first $k-1$ columns of the board.  For each of
        these ways, generate an extended set of positions by placing a queen
        in each row of the $k$th column.  Now filter these, keeping only
        the positions for which the queen in the $k$th column is safe with
        respect to the other queens.  This produces the sequence of all ways
        to place $k$ queens in the first $k$ columns.  By continuing this
        process, we will produce not only one solution, but all solutions to
        the puzzle.

        We implement this solution as a
        function
        <kbd>queens</kbd>, which returns
        a sequence of all solutions to the problem of placing $n$ queens on an
        $n\times n$ chessboard.  The function <kbd>queens</kbd> has an internal
        function
        <kbd>queens_cols</kbd> that returns the sequence of all ways to place queens in
        the first $k$ columns of the board.

        
        
        

        <div class="snippet" id="javascript_32_39_div"></div>
<div class="pre-prettyprint">
<pre class="prettyprint" title="Evaluate Javascript expression" onclick="new window.JavascriptConsole('function queeens(board_size) {\n   function queen_cols(k) {\n      if (k===0) \n         return list(empty_board);\n      else\n         return filter(function(positions) {\n                          return is_safe(k,positions);\n                       },\n                       flatmap(function(rest_of_queens) {\n                                  return map(function(new_row) {\n                                                return adjoin_position(new_row,\n                                                                       k,\n                                                                       rest_of_queens);\n                                             },\n                                             enumerate_interval(1,board_size));\n                               },\n                               queens_cols(k-1)));\n   }\n   return queen_cols(board_size);\n}','javascript_32_39','', event,1.0);window.eval('\n// function adjoin_position to be written by student\n          \n// function empty_board to be written by student\n          \n// function is_safe to be written by student\n          function accumulate(op,initial,sequence){if(is_empty_list(sequence)){return initial}else{return op(head(sequence),accumulate(op,initial,tail(sequence)))}};function append(list1,list2){if(is_empty_list(list1)){return list2}else{return pair(head(list1),append(tail(list1),list2))}};function map(fun,items){if(is_empty_list(items)){return[]}else{return pair(fun(head(items)),map(fun,tail(items)))}};function flatmap(proc,seq){return accumulate(append,[],map(proc,seq))};');">function queeens(board_size) {
   function queen_cols(k) {
      if (k===0) 
         return list(empty_board);
      else
         return filter(function(positions) {
                          return is_safe(k,positions);
                       },
                       flatmap(function(rest_of_queens) {
                                  return map(function(new_row) {
                                                return adjoin_position(new_row,
                                                                       k,
                                                                       rest_of_queens);
                                             },
                                             enumerate_interval(1,board_size));
                               },
                               queens_cols(k-1)));
   }
   return queen_cols(board_size);
}</pre>
<a href="http://source-ide-new.surge.sh/?snippet=function%20queeens(board_size)%20%7B%0A%20%20%20function%20queen_cols(k)%20%7B%0A%20%20%20%20%20%20if%20(k===0)%20%0A%20%20%20%20%20%20%20%20%20return%20list(empty_board);%0A%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20return%20filter(function(positions)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20is_safe(k,positions);%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20flatmap(function(rest_of_queens)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20map(function(new_row)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20adjoin_position(new_row,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20k,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rest_of_queens);%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20enumerate_interval(1,board_size));%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20queens_cols(k-1)));%0A%20%20%20%7D%0A%20%20%20return%20queen_cols(board_size);%0A%7D&amp;hidden=%0A//%20function%20adjoin_position%20to%20be%20written%20by%20student%0A%20%20%20%20%20%20%20%20%20%20%0A//%20function%20empty_board%20to%20be%20written%20by%20student%0A%20%20%20%20%20%20%20%20%20%20%0A//%20function%20is_safe%20to%20be%20written%20by%20student%0A%20%20%20%20%20%20%20%20%20%20function%20accumulate(op,initial,sequence)%7Bif(is_empty_list(sequence))%7Breturn%20initial%7Delse%7Breturn%20op(head(sequence),accumulate(op,initial,tail(sequence)))%7D%7D;function%20append(list1,list2)%7Bif(is_empty_list(list1))%7Breturn%20list2%7Delse%7Breturn%20pair(head(list1),append(tail(list1),list2))%7D%7D;function%20map(fun,items)%7Bif(is_empty_list(items))%7Breturn%5B%5D%7Delse%7Breturn%20pair(fun(head(items)),map(fun,tail(items)))%7D%7D;function%20flatmap(proc,seq)%7Breturn%20accumulate(append,%5B%5D,map(proc,seq))%7D;" class="snippet-ide-link btn btn-primary">[Open in IDE]</a>
</div>

        In this
        function
        <kbd>rest_of_queens</kbd> is a way to place $k-1$ queens
        in the first $k-1$ columns, and <kbd>new_row</kbd> is a proposed row in
        which to place the queen for the $k$th column.  Complete the program
        by implementing the representation for sets of board positions,
        including the
        function
        <kbd>adjoin_position</kbd>, which adjoins a new row-column
        position to a set of positions, and <kbd>empty_board</kbd>, which
        represents an empty set of positions.  You must also write the
        function
        <kbd>is_safe</kbd>, which determines for a set of positions,
        whether the queen in the $k$th column is safe with respect to the
        others.  (Note that we need only check whether the new queen is
        safe—the other queens are already guaranteed safe with respect to
        each other.)
        
      </EXERCISE>

      <EXERCISE>
        Louis Reasoner is having a terrible time doing Exercise <REF NAME="ex:8queens"></REF>.  His
        <kbd>queens</kbd>
        function
        seems to work, but it runs extremely slowly.
        (Louis never does manage to wait long enough for it to solve even the
        $6\times 6$ case.)  When Louis asks Eva Lu Ator for help, she points
        out that he has interchanged the order of the nested mappings in the
        <kbd>flatmap</kbd>, writing it as
        <kbd EVAL="no" class="snippet">flatmap(
  function(new_row) {
     return map(function(rest_of_queens) {
                   return 
                      adjoin_position(new_row,
                                      k,
                                      rest_of_queens);
                },
                queen_cols(k-1));
  },
  enumerate_interval(1,board_size))</kbd>

        Explain why this interchange makes the program run slowly.  Estimate
        how long it will take Louis's program to solve the eight-queens
        puzzle, assuming that the program in Exercise <REF NAME="ex:8queens"></REF> solves
        the puzzle in time $T$.
      </EXERCISE>
      
      
      
      
    <hr>
<div class="footnote">
<a class="footnote-number" id="footnote-1" href="32.html#footnote-link-1">[1] </a><FOOTNOTE>This 
          is, in fact, precisely the 
          
          <kbd>fringe</kbd>
          function
          from
          Exercise <REF NAME="ex:fringe"></REF>.  Here we've renamed it to emphasize that
          it is part of a family of general sequence-manipulation
          functions.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-2" href="32.html#footnote-link-2">[2] </a><FOOTNOTE>
          
          Richard Waters (1979)
          developed a program that automatically analyzes traditional 
          
          Fortran
          programs, viewing them in terms of maps, filters, and accumulations.
          He found that fully 90 percent of the code in the Fortran Scientific
          Subroutine Package fits neatly into this paradigm.  One of the reasons
          for the success of Lisp as a programming language is that lists
          provide a standard medium for expressing ordered collections so that
          they can be manipulated using higher-order operations.  The
          programming language 
          
          APL owes much of its power and appeal to a
          similar choice. In APL all data are represented as arrays, and there is a
          universal and convenient set of generic operators for all sorts of
          array operations.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-3" href="32.html#footnote-link-3">[3] </a><FOOTNOTE>According to 
          
          Knuth (1981), this rule was formulated by
          
          W. G. Horner early in the nineteenth century, but the method was
          actually used by Newton over a hundred years earlier.  Horner's rule
          evaluates the polynomial using fewer additions and multiplications
          than does the straightforward method of first computing $a_{n} x^n$,
          then adding $a_{n-1}x^{n-1}$, and so on.  In fact, it is possible to
          prove that any algorithm for evaluating arbitrary polynomials must use
          at least as many additions and multiplications as does Horner's rule,
          and thus Horner's rule is an 
          
          
          optimal algorithm for polynomial
          evaluation.  This was proved (for the number of additions) by
          
          A. M. Ostrowski in a 1954 paper that essentially founded the modern
          study of optimal algorithms.  The analogous statement for
          multiplications was proved by 
          
          V. Y. Pan in 1966.  The book by 
          
          
          <CITATION><p>Borodin and Munro (1975)</p>Borodin and Munro 1975</CITATION> 
          provides an overview of these and other results about
          optimal algorithms.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-4" href="32.html#footnote-link-4">[4] </a><FOOTNOTE>This definition uses the
          extended version of <kbd>map</kbd> described in footnote <REF NAME="foot:generalmap"></REF>.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-5" href="32.html#footnote-link-5">[5] </a><FOOTNOTE>This approach to nested mappings was shown
          to us by 
          
          David Turner, whose languages 
          
          KRC and 
          
          Miranda provide elegant
          formalisms for dealing with these constructs.  The examples in this
          section (see also Exercise <REF NAME="ex:8queens"></REF>) are adapted from Turner
          1981.  In Section <REF NAME="sec:exploiting-streams"></REF>, we'll see how this
          approach generalizes to infinite sequences.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-6" href="32.html#footnote-link-6">[6] </a><FOOTNOTE>We're
          representing a pair here as a list of two elements rather than as
          an ordinary pair.  Thus, the <QUOTE>pair</QUOTE> $(i,j)$ is represented as <kbd>list(i,j)</kbd>, not <kbd>pair(i,j)</kbd>.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-7" href="32.html#footnote-link-7">[7] </a><FOOTNOTE>The set $S-x$ is the set of all elements
          of $S$, excluding $x$.</FOOTNOTE>
</div>
<div class="footnote">
<a class="footnote-number" id="footnote-8" href="32.html#footnote-link-8">[8] </a><FOOTNOTE>
          
          
          
          The character sequence <kbd>//</kbd> in JavaScript code is used to
          introduce <EM>comments</EM>.  Everything from <kbd>//</kbd> to the end of
          the line is ignored by the interpreter.  In this book we don't use
          many comments; we try to make our programs self-documenting by using
          descriptive names.</FOOTNOTE>
</div></SUBSECTION></div>
    </div>

    <div class="nav">
    <!--
      <div type="button" class="btn btn-secondary">
        <a href="http://localhost:3000/chapters/31">&lt; Previous</a>
    </div>
    -->
      <div type="button" class="btn btn-secondary">
        <a class="scroll-next" href="33.html">Next &gt;</a>
      </div>


  </div>
  <script>
//<![CDATA[
var chapter_id = 32;
//]]>
</script>
  <div class="next-page"></div>
</div>

     </div><!-- /.container -->

     <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
     -->
   </body>
</html>
